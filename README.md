# ComfyUI Prompt & Workflow Extractor

A versatile suite of tools for extracting positive prompts and full workflow metadata from PNG images generated by [ComfyUI](https://github.com/comfyanonymous/ComfyUI). Whether you prefer a graphical user interface or command-line tools for scripting, this project has you covered.

Easily retrieve your creative prompts, analyze workflows, and manage your image generation metadata without needing to open ComfyUI.

## ‚ú® Key Features

- **Dual Interfaces**: Choose between a user-friendly GUI or powerful CLI tools.
- **Advanced GUI**: The main GUI application features:
    - **Drag & Drop**: Supports single files, multiple files, and entire folders.
    - **Rich Display**: View all extracted positive prompts in a clean, tabbed interface.
    - **File Summaries**: Get a quick overview of which files contained prompts.
    - **Easy Export**: Copy individual prompts, all prompts, or save them to a text file.
- **Powerful CLI**:
    - **Batch Processing**: Script and process thousands of images at once.
    - **Flexible Output**: Get prompts as plain text or structured JSON.
    - **Full Workflow Extraction**: Dump the entire ComfyUI workflow for analysis or reuse.
- **Intelligent Extraction**: The tools intelligently parse ComfyUI's metadata to find and isolate positive prompts, ignoring negative ones.

## üõ†Ô∏è Tools Overview

This repository contains several scripts, each tailored for a specific need.

| Script | Type | Description |
| :--- | :--- | :--- |
| `comfy_drop_ui.py` | **GUI** | **(Recommended for most users)** A feature-rich graphical interface for extracting positive prompts with drag-and-drop support for files and folders. |
| `comfyprompt_extractor.py` | **CLI** | The primary command-line tool for extracting **positive prompts**. Ideal for batch processing. |
| `comfyui_extractor.py` | **CLI** | A command-line tool to extract the **entire workflow metadata** from a PNG file. |
| `wlsh_prompt_extractor_ui.py` | GUI | A simpler, single-file GUI for extracting a positive prompt from the `parameters` metadata key. |
| `prompt_extractor.py` | CLI | A simpler, single-file CLI alternative to the main prompt extractor. |

## üöÄ Installation

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/your-username/comfyui_prompt_extractor.git
    cd comfyui_prompt_extractor
    ```

2.  **Install the required Python packages:**
    ```bash
    pip install -r requirements.txt
    ```
    This will install `Pillow`, `pyperclip`, and `tkinterdnd2` for the GUI's drag-and-drop functionality.

## üìã Usage Guide

### üñ•Ô∏è GUI Application

For a simple and visual experience, run the `comfy_drop_ui.py` script.

```bash
python comfy_drop_ui.py
```

- **Drag and Drop**: Drag PNG files or folders directly onto the application window.
- **Browse**: Use the "Browse File" or "Browse Folder" buttons.
- **View & Export**: Prompts will appear in the text box. Use the buttons to copy them to your clipboard or save them to a `.txt` file.

### ‚å®Ô∏è Command-Line Interface (CLI)

For automation, batch processing, or integration with other scripts, use the CLI tools.

#### Extracting Positive Prompts (`comfyprompt_extractor.py`)

- **Process a single image:**
  ```bash
  python comfyprompt_extractor.py "path/to/your_image.png"
  ```

- **Process all PNGs in a directory (and subdirectories):**
  ```bash
  python comfyprompt_extractor.py "path/to/your_folder/"
  ```

- **Get only the prompt text:**
  ```bash
  python comfyprompt_extractor.py "image.png" --prompt-only
  ```

- **Save prompts to a text file next to each image:**
  ```bash
  python comfyprompt_extractor.py "images_folder/" --save-txt
  ```

- **Save prompts to a specific directory:**
  ```bash
  python comfyprompt_extractor.py "images_folder/" --save-json --output "path/to/output_folder/"
  ```

#### Extracting Full Workflows (`comfyui_extractor.py`)

- **View a summary of the workflow:**
  ```bash
  python comfyui_extractor.py "path/to/your_image.png"
  ```

- **Save the workflow data to a JSON file (for importing into ComfyUI):**
  ```bash
  python comfyui_extractor.py "image.png" --save-workflow
  ```

- **Save all metadata to a JSON file:**
  ```bash
  python comfyui_extractor.py "image.png" --save-all
  ```

## üìÑ License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

---

*Authored by Mattia Moretti*
